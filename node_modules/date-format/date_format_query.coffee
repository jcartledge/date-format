json = require "json-parse"
path = require "path"
DateFormatChar = require path.resolve(__dirname, "date_format_char")

class DateFormatQuery
  constructor: (@lang = "php") ->
    raw_format_chars = json.sync path.resolve __dirname, "data", @lang, "format_characters.json"
    @format_chars = []
    raw_format_chars.map (raw) =>
      @format_chars.push new DateFormatChar raw.char, raw.description, raw.regex

  match: (str) ->
    matches = {}
    @format_chars.map (fc) =>
      match = fc.match str
      if match
        matches[match.index] ?=
          start: match.index
          match: match[0]
          options: {}
        matches[match.index].options[fc.char] = fc.description
    matches

module.exports = DateFormatQuery
